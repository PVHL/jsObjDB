<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: jsObjDB</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: jsObjDB</h1>

    




<section>

<header>
    
        <h2>
        jsObjDB
        </h2>
        
            <div class="class-description">A javascript storage engine for browsers and node.js.</div>
        
    
</header>

<article>
    <div class="container-overview">
    
        
<dt>
    
        <h4 class="name" id="jsObjDB"><span class="type-signature"></span>new jsObjDB<span class="signature">(prim_key<span class="signature-attributes">opt</span>, async<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>prim_key</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">A unique and required key for the data. Is optional. Note that an
                          internal unique field named _id is always created anyway 
                          and can be used for unique indexing if required. Defaults to none.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>async</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">Should delegates and callbacks be called asynchronously? Defaults to false.</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line591">line 591</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
var db2 = jsObjDB("user_id", true);
                          </code></pre>

    
</dd>

    
    </div>

    

    

    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        <dl>
            
<dt>
    
        <h4 class="name" id="addDelegate"><span class="type-signature"></span>addDelegate<span class="signature">(reg_id, delegate, binding)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        A delegate is a method that is called on *any* change to the DB (insert, update, upsert, delete).
Each delegate is recorded using a ref_id for easy deletion.
When called, the delegate is passed an event descriptor - with lots of information
about the operation that had just occurred: fn(event)<p>

The event descriptor will include:<p>
 type: one of "insert", "update", "upsert", "delete". <p>
The event descriptor may include one or more cursors describing changes made to the database: <p>
<ul>
 <li>inserted: all items that were inserted<br>
 <li>deleted: all items that were deleted<br>
 <li>updated: all items that were updated<br>
 <li>failed: all items that failed to be inserted or updated<br>
</ul>
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>reg_id</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>
|

<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">An ID of this delegate. Used for quick delete</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>delegate</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">The function to call on any change</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The object to bind the function to. (optional - defaults to "this")</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line771">line 771</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>db.addDelegate("deleg1", function(event) {
    if (event.failed &amp;&amp; event.failed.length > 0) {
    //   There are some failures... deal with it
    }
    if (event.inserted &amp;&amp; event.inserted.length > 0) {
    //   There are some new records - add them to the DOM
    }
    ...
});</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="addIndex"><span class="type-signature"></span>addIndex<span class="signature">(property, unique, required)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Add an index on a single property. Access to items can ben sped up
*significantly* (although only the $in and $eq operators are currently supported).
<p>
You can add indexes at any time, an attempt will be made to insert all existing elements
into that index. Any failure will cause the index to be discarded and an exception thrown.
<p>
Each index keeps tabs on how much it partitions the data - more partitioning (i.e. more unique
values) means a more efficient index. Conversely, an index where all objects stored have the
same value is a very inefficient index. At query time - the best index will be 
chosen for use.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>property</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Name of the property</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unique</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            

            

            <td class="description last">Is this a unique index. @default false</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>required</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            

            

            <td class="description last">Does every item need this value?</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line834">line 834</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="count"><span class="type-signature"></span>count<span class="signature">(query)</span><span class="type-signature"> &rarr; {Number}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Return the number of elements held in the jsObjDB, or number
of elements in a query set.
<p>
We *do NOT* provide a length because we dont want jsObjDB mistaken for
an array - IT IS NOT. Its store can have holes, and there are no user accessible
integer semantics for access.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Set to count</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1369">line 1369</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Number of items in the set (if query is blank, returns total count)
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Number</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var itemCount = db.count();  //  return count of all items (note: this will be very fast)
var itemCount = db.count({});  //  also return count of all items (note: this will be very fast)
var itemCount = db.count({a: 1}); // return count of items with a == 1;
var itemCount = db.count({a: { $gt: 3 }}); // return count of items with a > 3;</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="delete"><span class="type-signature"></span>delete<span class="signature">(query, cb, binding)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Delete a set of items from the database. Uses a query to select items.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Query descriptor.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Callback function at the end of the deletion. Is passed the deleted set.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Bound to this during the callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1284">line 1284</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    The cursor containing the deleted items. Not bound to a DB.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
... // fill the database
db.delete({a: 4}, function(event) {
    console.log("Deleted %d items", event.deleted.length);
    event.deleted.each(function(item) { console.log(item); });
}, this);</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="exists"><span class="type-signature"></span>exists<span class="signature">(qry)</span><span class="type-signature"> &rarr; {Boolean}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Returns true if there exists at least ONE item that matches the query
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>qry</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Query</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1534">line 1534</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    True if there exists at least one match, false otherwise.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Boolean</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB("a");
...  // fill the database up
if (db.exists({a: { $lt: 5 }})) {
    //   come here if any objects have a &lt; 5.
}</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="find"><span class="type-signature"></span>find<span class="signature">(query, cb, binding)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Find matching objects from the DB. Query is used as a selector.
<p>
If a callback is provided, it is called with a cursor representing the found
items. That same cursor is also returned and can be used in chained calls.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Description of the search criteria</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Callback function with a cursor object representing the results</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Bound to this during callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1395">line 1395</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Cursor containing all elements matching the query.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var cursor = db.find({a: { $ge: 5 }});
console.log(cursor.length);  //  prints the number of elements with a >= 5
var cursor = db.find({b: 5}).sort("c").uniq("c");
// cursor now contains all elements with b == 5, sorted on 'c' with duplicates removed.</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="findOne"><span class="type-signature"></span>findOne<span class="signature">(query, cb)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Find the first item that matches, and return it.
NOTE that we DO NOT return a cursor, but an item.
The CB also gets the ITEM. This cannot be changed.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The query object</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1446">line 1446</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    The matching item
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="findWhere"><span class="type-signature"></span>findWhere<span class="signature">(cb, binding<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {<a href="Cursor.html">Cursor</a>}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Find all elements using a custom test function. The function is passed each object in turn, and
should return true on a successful test. If a binding parameter is used, it will be bound to 'this'
during function invocation. Otherwise the jsObjDB is bound.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last">Callback for testing inclusion</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    this
                
                </td>
            

            <td class="description last">Context for the callback function</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1513">line 1513</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    A cursor containing all found items
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="Cursor.html">Cursor</a></span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var cursor = db.findWhere(function(item) { return item.a > 5; });</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="insert"><span class="type-signature"></span>insert<span class="signature">(items, cb, binding)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Insert a list of objects into the DB.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>items</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array</span>


            
            </td>

            

            

            <td class="description last">An array of objects to be inserted into the DB</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">A callback function, called when the operation is complete. The callback
                          will be called using f({ type: "insert", inserted: inserted, failed: failed) where each is a cursor.
                          The inserted cursor will be bound to the DB, the failed cursor is not
                          bound to a DB.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The binding for this when calling the callback function</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line887">line 887</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    An object containing the operation type "insert" and the cursors: inserted, failed.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB("a"); // Note that a is a primary key, and therefore required
db.insert([{a:1,b:2}, {a:2}, {c:3}]); // two elements get inserted. The third fails (requires 'a')</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="insertOne"><span class="type-signature"></span>insertOne<span class="signature">(item, cb, binding)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Insert a single object into the DB. Throws an exception on failure. 
Returns the item on success with its _id set.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>item</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The object to be inserted into the DB.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Function to call after success (will be passed a full event descriptor)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The object to bind to this for the callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line925">line 925</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    The item inserted WITH _id now set.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="load"><span class="type-signature"></span>load<span class="signature">(name)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Load this DB from the localStore. Note that you must construct an jsObjDB then
call "load" on it - i.e. this is not a constructor.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>name</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Name used to uniquely identify this jsObjDB in the localStore.</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line640">line 640</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="jsObjDB.html#persist">jsObjDB#persist</a></li>
        </ul>
    </dd>
    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    The jsObjDB loaded. Actually just "this".
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB().load("MyData");</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="loadFromJSON"><span class="type-signature"></span>loadFromJSON<span class="signature">(json)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Load this DB from a JSON string.
Not usually for user consumption - but may be useful if the DB is being 
transmitted.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>json</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">JSON encoded instance of jsObjDB. Must have been created by toJSON().</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line657">line 657</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="jsObjDB.html#toJSON">jsObjDB#toJSON</a></li>
        </ul>
    </dd>
    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Returns "this" - the jsObjDB object.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>socket.onmessage = function (evt) {
var db = jsObjDB().loadFromJSON(evt.data);
};</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="persist"><span class="type-signature"></span>persist<span class="signature">(name)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Save this DB to persistent store (localStorage). If localStorage is not supported on this
browser, then an exception is raised.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>name</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">Name used to uniquely identify this jsObjDB in the localStore</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line623">line 623</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="jsObjDB.html#load">jsObjDB#load</a></li>
        </ul>
    </dd>
    

    
</dl>


    

    

    

    

    

    

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
...  // store lots of data
db.persist("MyData");</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="removeDelegate"><span class="type-signature"></span>removeDelegate<span class="signature">(reg_id)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Remove a delegate function - it will no longer be called after operations. Note
that delegates are referenced by their ID use during addDelegate.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>reg_id</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>
|

<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">The reference for the delegate to be deleted.</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line790">line 790</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="removeIndex"><span class="type-signature"></span>removeIndex<span class="signature">(property)</span><span class="type-signature"></span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Remove an index.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>property</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The property that is indexed.</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line866">line 866</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="sizeof"><span class="type-signature"></span>sizeof<span class="signature">()</span><span class="type-signature"> &rarr; {Number}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Return the approximate size of this jsObjDB instance - including all data stored in it.
    </div>
    

    

    

    

    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line706">line 706</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Approximate space used, in bytes, of this database, its storage and indexes.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Number</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
...  // fill with data
console.log("Database size is approximately", db.sizeof());</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="toJSON"><span class="type-signature"></span>toJSON<span class="signature">()</span><span class="type-signature"> &rarr; {String}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Save the jsObjDB to a JSON string.
    </div>
    

    

    

    

    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line686">line 686</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="jsObjDB.html#loadFromJSON">jsObjDB#loadFromJSON</a></li>
        </ul>
    </dd>
    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Returns the JSON string
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">String</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
...  // fill with data
socket.send(db.toJSON());</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="toString"><span class="type-signature"></span>toString<span class="signature">()</span><span class="type-signature"> &rarr; {String}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Create a string descriptor of the jsObjDB. Useful for debugging.
    </div>
    

    

    

    

    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line733">line 733</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    String overview.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">String</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>console.log(db.toString());</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="update"><span class="type-signature"></span>update<span class="signature">(query, changes, cb, binding)</span><span class="type-signature"> &rarr; {Array}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Update some values in the DB.
<p>
The query parameter chooses a set of objects to be updated.
<p>
The changes parameter specifies what changes are to be applied.
The changes object contains a set of "property" and "modifications" values.
<p>
Note that an update as a whole may cause index duplication while the update
is happening. For example: an int PK. You delete number 5, then move all 6-
elements down. During the move, 7 may get moved to 6 BEFORE 6 gets moved to 5.
So the update will fail.

NOTE: if, when attempting to re-insert the item, and we get failed
indexes, then we UNDO all changes, reinsert the original, and throw.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">A query selecting a group of objects to be modified</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>changes</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">A set of operations to apply to those objects</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">A callback executed with the summary of changes.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Bound to this during callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1174">line 1174</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    Returns two cursors - updated and failed.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>var db = jsObjDB();
db.insertOne({a:1, b: {c: [1,2,3]}});
db.update({}, {a: { $inc: 1}, "b.c": { $push: 4 }});
db.find({ a: 2}); // returns: {a: 2, b: { c: [1, 2, 3, 4]}}</code></pre>

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="upsert"><span class="type-signature"></span>upsert<span class="signature">(items, cb, binding)</span><span class="type-signature"> &rarr; {Array}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Upsert a set of items. See upsertOne for a spec on what happens to each item.
Upsert will always return a set of updated, inserted and failed cursors.
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>items</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array</span>


            
            </td>

            

            

            <td class="description last">Array of items to be upserted</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Callback called on completion</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Bound to this for callback.</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1058">line 1058</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    List of inserted, updated and failed cursors. Note that the
                    failed cursor is not bound to a DB because the items dont
                    exist anywhere. They could not be inserted.
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array</span>


    </dd>
</dl>

        

    
</dd>

        
            
<dt>
    
        <h4 class="name" id="upsertOne"><span class="type-signature"></span>upsertOne<span class="signature">(item, cb, binding)</span><span class="type-signature"> &rarr; {Object}</span></h4>

        
    
</dt>
<dd>

    
    <div class="description">
        Run one Upsert. If the primary key already exists, then we convert
this to an update of that existing item. We simply merge the new item
onto the existing item. The existing items "_id" is kept, but for all other
properties, the new item has precendence.
<p>
It is possible that the insert or update will fail because it violates
some other key. In which case the original item is restored, and
an exception will be thrown.
<p>
Items are searched for using the _id field (if present) or the primary key.
<p>
If an item was inserted, returns the item.
If an item was updated, returns null (you already have a way to find the item)
If the new item could not be inserted, throws
    </div>
    

    

    

    

    
        <h5>Parameters:</h5>
        

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>item</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">The item to be upserted.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">Callback function to be called at the completion of the upsert.
                          Will be called with the item that was upserted.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>binding</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">Bound to this during the callback</td>
        </tr>

    
    </tbody>
</table>
    

    


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="jsobjdb.js.html">jsobjdb.js</a>, <a href="jsobjdb.js.html#line1017">line 1017</a>
    </li></ul></dd>
    

    

    

    
</dl>


    

    

    

    

    

    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    The item that was upserted
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

        

    
        <h5>Example</h5>
        
    <pre class="prettyprint"><code>db.insertOne({a: 2});
db.upsertOne({a: 2, b: 3}); //   replaces the former object
var obj = db.findOne({a: 2});
obj.d = 7;
obj.a = 3;
db.upsert(obj);  // replaces {a: 2} object - uses the _id field for matching.
db.upsert({a:4});  // inserts a new object</code></pre>

    
</dd>

        </dl>
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Cursor.html">Cursor</a></li><li><a href="jsObjDB.html">jsObjDB</a></li><li><a href="ObjIndex.html">ObjIndex</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Mon Dec 01 2014 21:53:31 GMT+1300 (NZDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>